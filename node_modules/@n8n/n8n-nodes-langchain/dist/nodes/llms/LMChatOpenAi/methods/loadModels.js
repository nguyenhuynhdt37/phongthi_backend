"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.searchModels = searchModels;
const openai_1 = __importDefault(require("openai"));
async function searchModels(filter) {
    const credentials = await this.getCredentials('openAiApi');
    const baseURL = this.getNodeParameter('options.baseURL', '') ||
        credentials.url ||
        'https://api.openai.com/v1';
    const openai = new openai_1.default({ baseURL, apiKey: credentials.apiKey });
    const { data: models = [] } = await openai.models.list();
    const filteredModels = models.filter((model) => {
        const isValidModel = (baseURL && !baseURL.includes('api.openai.com')) ||
            model.id.startsWith('ft:') ||
            model.id.startsWith('o1') ||
            model.id.startsWith('o3') ||
            (model.id.startsWith('gpt-') && !model.id.includes('instruct'));
        if (!filter)
            return isValidModel;
        return isValidModel && model.id.toLowerCase().includes(filter.toLowerCase());
    });
    filteredModels.sort((a, b) => a.id.localeCompare(b.id));
    const results = {
        results: filteredModels.map((model) => ({
            name: model.id,
            value: model.id,
        })),
    };
    return results;
}
//# sourceMappingURL=loadModels.js.map